# TestFlow V2 理论动态生成系统需求文档

## 项目背景与核心痛点

当前 TestFlow V1 采用固定理论映射模式，将用户输入的主题硬编码对应到预设心理学理论（如"图像投射型"对应"荣格投射理论"）。当用户输入非常规主题（如"自己参军打仗的生存率""变成一只猫的概率""逃离城市的可能"）时，系统无法找到适配的理论框架，导致：

1. 套用不相关理论，产生**理论空洞**
2. AI 被迫"幻觉"解释，损害测评可信度
3. 维护成本极高，每新增一类主题需人工编写映射规则

**核心诉求**：建立一套**内在分析方法论**，使系统能够自主解构任意主题并构建合理的测评逻辑，无需持续维护映射表或新增 Prompt。

---

## 核心设计原则

### 1. 解构优先于映射
不维护"主题→理论"映射表，而是训练系统掌握**主题分析的方法论**，像心理学家面对新构念时一样，从现象层逐步深入到心理机制层。

### 2. 分层建构理论
不追求"正确理论"，而是构建**可解释、自洽、可验证**的临时理论框架。该框架需明确说明：
- 表面意象是什么
- 深层构念是什么  
- 测量目标是什么
- 为什么选择这些基础理论组合

### 3. 置信度透明化
对构建的理论框架进行**自我评估**，明确告知用户这是基于经典理论的延伸应用，还是完全构建性的创意测评，避免虚假科学性。

### 4. 形式与内容解耦
理论层只负责回答"测什么"和"为什么"，形式层（图像投射/场景剧情/指数型等）只负责回答"怎么呈现"，两者通过清晰的接口交互。

---

## 系统架构调整

### 新增模块：主题解构引擎（Topic Deconstruction Engine）

该引擎替代原有的固定理论映射层，成为系统的第一层处理逻辑。

#### 输入
- `topic`: 用户输入的任意字符串（2-120字）

#### 输出
- `analysis_report`: 主题解构报告（包含表面意象、深层构念、测量目标）
- `theory_framework`: 动态构建的理论框架（包含基础理论组合、维度拆解、置信度评估）
- `form_constraints`: 形式适配建议（传递给第二层）

---

## 第一层：主题解构与理论建构（核心创新）

### 阶段一：语义分层解析

系统必须对任意主题进行三层解构，形成标准化的分析语法：

**第一层：表面意象层（Surface Imagery）**
- 提取主题中的**具象词汇**和**场景元素**
- 识别**感官通道**（视觉/听觉/触觉/动觉）
- 标注**情绪基调**（积极/消极/中性/矛盾）

**第二层：深层构念层（Deep Construct）**
- 将具象元素**抽象为心理构念**
- 识别**行为倾向**（接近/回避/控制/顺从）
- 判断**时间指向**（过去反刍/当下体验/未来预期）

**第三层：测量目标层（Assessment Goal）**
- 明确测评的**功能定位**：
 - 预测性（Predictive）：预测未来行为/状态
 - 描述性（Descriptive）：描绘当前特质/模式
 - 投射性（Projective）：揭示潜意识倾向
 - 娱乐性（Entertainment）：满足好奇心和社交分享

### 阶段二：基础理论选择逻辑

系统掌握一个**基础理论工具箱**，根据阶段一的分析结果自主选择组合，而非根据主题名称匹配：

| 分析特征 | 候选基础理论 | 选择逻辑 |
|---------|------------|---------|
| 涉及自我形象/未来想象 | 可能自我理论（Possible Selves, Markus & Nurius） | 测量"希望自我"与"恐惧自我"的张力 |
| 涉及决策/选择困境 | 双系统理论（Dual Process, Kahneman）/ 前景理论（Prospect Theory） | 测量直觉vs理性加工倾向 |
| 涉及风险/安全评估 | 风险评估理论（Risk Perception, Slovic）/ 保护动机理论（Protection Motivation） | 测量风险敏感度与应对资源 |
| 涉及人际关系/依恋 | 依恋理论（Attachment, Bowlby/Ainsworth）/ 社会交换理论（Social Exchange） | 测量关系模式与亲密策略 |
| 涉及压力/挑战应对 | 应激-应对理论（Stress-Coping, Lazarus）/ 心理韧性理论（Resilience） | 测量应对风格与恢复能力 |
| 涉及身份/角色认同 | 身份认同理论（Identity, Erikson/Tajfel）/ 自我决定理论（Self-Determination） | 测量身份探索与承诺水平 |
| 涉及叙事/生命历程 | 叙事心理学（Narrative Psychology, McAdams）/ 人生脚本理论（Life Script, Berne） | 测量主导人生叙事类型 |
| 涉及生理/本能反应 | 进化心理学（Evolutionary Psychology）/ 战斗-逃跑-僵住反应（Fight-Flight-Freeze） | 测量本能行为模式 |
| 涉及控制/自主需求 | 控制点理论（Locus of Control, Rotter）/ 自我效能理论（Self-Efficacy, Bandura） | 测量控制感与能力信念 |
| 涉及道德/价值判断 | 道德基础理论（Moral Foundations, Haidt）/ 价值澄清理论（Values Clarification） | 测量价值取向与道德直觉 |

**组合规则**：
- 单一主题通常选择 **2-3 个基础理论** 组合
- 组合需说明**互补逻辑**（如"前景理论解释决策偏差，控制点理论解释决策后的归因风格"）
- 避免**理论冲突**（如不要同时用"特质理论"和"情境理论"解释同一行为，除非明确说明交互）

### 阶段三：维度拆解与操作化

将深层构念拆解为 **3-5 个可测量维度**，每个维度必须包含：

- **维度名称**：简洁标签（如"风险认知偏差""集体服从倾向"）
- **操作定义**：具体说明该维度在测评情境中的表现（如"在资源有限时，优先保障团队还是个人生存"）
- **理论基础**：明确关联到阶段二选择的某个基础理论（如"基于前景理论中的损失厌恶"）
- **指标类型**：行为指标（Behavioral）/ 自陈指标（Self-report）/ 投射指标（Projective）
- **预期变异**：该维度在人群中的分布预期（正态/偏态/双峰）

### 阶段四：置信度自评估

系统必须对构建的理论框架进行自我审查，输出：

- **理论适配度**（Theory Fit）：high / moderate / low
 - high：主题与基础理论有直接对应关系（如"拖延症"与"自我调节理论"）
 - moderate：需要跨理论组合或概念延伸（如"副业指数"与"可能自我+自我效能"）
 - low：主题高度虚构或抽象，理论为构建性应用（如"变成猫的概率"）

- **效度威胁**（Validity Threats）：列出该测评可能存在的效度问题（如"表面效度过高导致伪装""社会赞许性偏差"）

- **适用边界**（Scope of Application）：明确说明该测评适合什么场景，不适合什么场景

---

## 第二层：形式适配与内容生成（约束层）

接收第一层的 `theory_framework` 和 `form_constraints`，严格执行形式约束，确保输出符合特定测评类型的结构规范。

系统根据模板数量进行**抽卡生成**，每种形式有独立的约束规则：

### 形式约束规范（保持 V1 标准）

**图像投射型（Projective Imagery）**
- 必须提供**视觉元素描述**（即使不生成真实图片，也要描述画面构成）
- 选项差异基于**知觉-联想机制**（如"第一眼看到什么"反映注意偏向）
- 避免文化特定符号，优先使用**原型意象**（archetypal imagery）
- 结果解释必须关联到第一层的**投射指标维度**

**场景选择剧情型（Scenario Narrative）**
- 构建 **5-7 个递进式场景**，每个场景包含**决策冲突点**
- 每个选择支必须**明确对应**第一层的某个维度
- 剧情分支需体现**累积效应**（前期选择影响后期选项）
- 结局多样性：根据维度组合生成 **4-6 种不同结局**，而非简单高分/低分

**情感依恋指数型（Attachment Index）**
- 必须包含**关系触发情境**（分离焦虑、亲密需求、冲突处理、承诺恐惧）
- 反应选项覆盖**焦虑-回避双轴**（或安全型作为基准）
- 指数计算需基于**标准化计分逻辑**（即使前端只展示标签，后端也要有连续分数）
- 结果解释参考 **Bartholomew-Horowitz 四类型模型** 或 **Fraley 连续测量模型**

**人生潜力型（Potential Assessment）**
- 基于**成长型思维理论**（Growth Mindset, Dweck）和**自我实现理论**
- 测量**潜能维度**而非当前能力（如"学习敏锐度""逆境商数""创造倾向"）
- 提供**发展性建议**而非定性判断（如"如果加强X方面训练，Y潜力可提升"）

**心理健康自评型（Mental Health Screening）**
- 必须基于 **DSM-5** 或 **ICD-11** 症状标准，或主流筛查量表（PHQ-9/GAD-7/PCL-5等）
- 频率/严重程度量表 **4 级标准化**（如 0=从不，1=偶尔，2=经常，3=总是）
- 必须包含**功能影响评估**（症状对工作、社交、生活的干扰程度）
- **风险提示机制**：检测到高风险症状时，必须提供求助资源建议

---

## 特殊主题处理协议

### 极端虚构主题（如"变成一只猫的概率""在火星开咖啡馆的成功率"）

**分析策略**：
- 不否认主题的荒诞性，而是挖掘其**隐喻价值**
- 将"变成猫"解构为："身份流动性""本能vs文明""自主性幻想"等构念
- 理论选择：**叙事心理学**（测量"可能自我"的极端形式）+ **具身认知**（Embodied Cognition，测量身体认同）

**形式适配**：
- 强制使用**图像投射型**或**场景剧情型**（避免指数型，防止虚假科学性）
- 结果解释采用**隐喻性语言**（如"你的内在猫性指数：你拥有猫的好奇心与独立性，但缺乏猫的领地意识"）
- **置信度标记**：强制标记为 low，明确告知用户此为创意娱乐测评

### 极端现实主题（如"自己参军打仗的生存率""破产概率评估"）

**分析策略**：
- 拒绝提供真实的**概率预测**（避免虚假科学和伦理风险）
- 将主题重构为：**应激反应模式**、**风险评估风格**、**决策偏好**
- 理论选择：**战斗-逃跑-僵住反应** + **前景理论** + **心理韧性理论**

**形式适配**：
- 使用**场景剧情型**，构建高压决策情境
- 结果解释聚焦于**心理特质画像**（如"你是战略型应对者：在危机中保持冷静，但可能过度分析错失时机"）
- **伦理审查**：自动添加免责声明，明确说明结果不代表真实预测

### 模糊抽象主题（如"副业指数""逃离城市的可能"）

**分析策略**：
- 识别**行为意向**（Behavioral Intention）与**行动障碍**（Action Barriers）
- 理论选择：**计划行为理论**（Theory of Planned Behavior）+ **自我决定理论**（测量内在动机vs外在压力）

**形式适配**：
- 使用**指数型**或**场景剧情型**
- 结果提供**行动阶梯**（Action Ladder）：从当前状态到目标状态的渐进路径

---

## 输出规范

### 第一层输出格式（JSON）

```json
{
 "deconstruction": {
   "surface_imagery": {
     "concrete_elements": ["元素1", "元素2"],
     "sensory_channel": "visual/auditory/kinesthetic",
     "emotional_tone": "positive/negative/neutral/ambivalent"
   },
   "deep_construct": {
     "abstract_concept": "核心心理构念",
     "behavioral_tendency": "approach/avoidance/control/submission",
     "time_orientation": "past/present/future"
   },
   "assessment_goal": "predictive/descriptive/projective/entertainment"
 },
 "theory_framework": {
   "primary_theories": [
     {
       "name": "理论名称",
       "application_logic": "为什么选择该理论（2句话）"
     }
   ],
   "dimensions": [
     {
       "name": "维度名称",
       "definition": "操作定义",
       "theory_base": "关联的基础理论",
       "indicator_type": "behavioral/self-report/projective",
       "expected_distribution": "normal/skewed/bimodal"
     }
   ],
   "confidence": {
     "level": "high/moderate/low",
     "reasoning": "置信度评估理由",
     "validity_threats": ["威胁1", "威胁2"],
     "scope": "适用场景与边界说明"
   }
 },
 "form_constraints": {
   "recommended_styles": ["图像投射型", "场景剧情型", "情感依恋指数型", "人生潜力型", "心理健康自评型"],
   "style_adaptation_notes": "针对不同形式的特殊调整建议",
   "special_considerations": ["特殊注意点1", "注意点2"]
 }
}