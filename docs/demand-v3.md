# TestFlow V3 预览与导出体验需求文档

## 项目背景与 V3 目标

V2 理论动态生成系统已全部实现，当前系统具备主题解构、多形式变体生成、预览与导出能力。V3 聚焦**预览与导出链路**的体验与适配，面向**小红书图文投放**与**移动端 H5 体验**进行迭代。

**核心诉求**：

1. 精简 ZIP 导出物：素材目录更名为 material，仅保留私信话术（dmScripts）。
2. 截图与 HTML 按小红书竖图 3:4 适配，便于直接用于小红书图文投放。
3. Preview 页与导出的独立 HTML 在手机模式下排版新颖、好看，移动端 H5 体验良好。
4. Preview 页沿用三栏布局，手机预览区域支持多分辨率切换，分辨率切换控件置于手机预览右上方。

---

## 需求一：ZIP 导出素材目录（material，仅保留 dmScripts）

### 目标

将原 `copy/` 目录更名为 `material/`，且 ZIP 内**仅保留私信话术**（dmScripts），去掉标题、正文、话题等文案文件及相关逻辑，减少冗余、命名更贴合「素材包」语义。

### 现状

当前 `downloadFullZipBundle` 会在 ZIP 内生成：

- `copy/titles.txt`
- `copy/content.txt`
- `copy/hashtags.txt`
- `copy/dm_scripts.json`

README.txt 中列举上述 copy 路径。数据来自 `variant.copyPackage` 或各字段回退。

### 迭代内容

1. **目录与内容**
   - ZIP 内不再使用 `copy/`，改为 **`material/`**。
   - **仅保留** 私信话术：`material/dm_scripts.json`（内容为 `variant.copyPackage?.dmScripts ?? variant.dmScripts` 的 JSON，结构可保持现有 `{ scripts: [...] }`）。
   - **移除**：`titles.txt`、`content.txt`、`hashtags.txt` 的生成与写入；不再从 `copyPackage.titles / content / hashtags` 或对应回退逻辑组装这些文件。

2. **README**
   - `buildReadme` 中「包含文件」只列出：`index.html`、`screenshots/*`、`material/dm_scripts.json`、`README.txt`。
   - 可增加一句说明：`material/dm_scripts.json` 为私信话术素材，便于投放使用。

3. **代码与类型**
   - 从 `downloadFullZipBundle` 中删除对 titles、content、hashtags 的组装与 `zip.file(...)` 调用；保留对 `material/dm_scripts.json` 的写入。
   - 若类型或别处仅因「ZIP 内 copy 文件」而依赖 `copyPackage.titles/content/hashtags`，可评估后删除或保留字段（仅不再写入 ZIP）；与 dmScripts 相关的保留。

### 验收

- 导出的完整 ZIP 解压后存在 `material/dm_scripts.json`，不存在 `copy/` 目录及任何 `titles.txt`、`content.txt`、`hashtags.txt`。
- README 中仅描述上述包含文件，且对 material 有简短说明。

---

## 需求二：截图与 HTML 的小红书竖图 3:4 适配

### 目标

导出物面向**小红书图文**：截图采用**竖图 3:4**（如 1080×1440），独立 HTML 在 3:4 视口下尽量一屏展示核心内容，便于截出可直接用于小红书投放的单图。

### 现状

- 截图逻辑（`lib/screenshot.ts`）当前即为 1080×1440（3:4），需确认与 HTML 的视觉一致性与一屏展示优化。
- 独立 HTML（`buildStandaloneHtml`）为桌面优先，未针对 3:4 竖屏做「一屏内展示」的专门优化。

### 迭代内容

1. **截图**
   - 保持截图画布 **1080×1440**（3:4 竖图），适配小红书图文。
   - `createBaseSlide` 及所有生成截图的 padding、字号、排版在一屏内可读、布局平衡，风格与独立 HTML 一致。

2. **独立 HTML**
   - 在保持现有桌面/移动响应式的前提下，增加对** 3:4 竖屏视口**的适配：
     - 在 3:4 比例视口（或 iframe 内）下，首屏（封面）尽量一屏展示标题、描述、主文案；
     - 字体、间距、留白在该比例下不显空洞或拥挤。
   - 实现方式可为：在 `buildStandaloneHtml` 输出中增加针对 3:4 视口的样式（如基于 aspect-ratio 或固定宽高比的 media query / 容器样式），或为单图导出提供 3:4 优先的布局模式，便于截图管线截取。

3. **ZIP 与说明**
   - README 或导出说明中注明截图尺寸为 **1080×1440（竖图 3:4）**，适配小红书图文。

### 验收

- 截图输出为 1080×1440，3:4 竖图，单张内容完整可读、适合小红书图文。
- 独立 HTML 在 3:4 竖屏视口下，首屏内容一屏内完整展示、无多余留白或严重裁切。
- 文档/README 中明确写明「小红书竖图 3:4」及 1080×1440。

---

## 需求三：Preview 与导出 HTML 的移动端排版与体验

### 目标

在手机模式下，Preview 页内嵌预览与导出的独立 HTML **不浪费空间**，标题、描述、文案层级清晰，整体**新颖、好看**，移动端 H5 体验良好。无额外品牌或字号等硬性约束，以视觉效果与体验为准。

### 现状

- Preview 页通过 iframe 嵌入 `buildStandaloneHtml` 生成的 HTML，内容为桌面优先布局，在窄屏下易产生留白、层级不够紧凑。
- 导出 HTML 未针对移动端做专门排版，在真机打开时易显得空洞或信息密度不均。

### 迭代内容

1. **导出 HTML（`buildStandaloneHtml`）**
   - 增加移动端样式（媒体查询或移动优先块）：
     - 窄视口下 `.app` 宽度 100%，减少左右留白；
     - 标题、描述、卡片内字号与间距优化，层次分明、触控友好；
     - 整体风格**新颖、好看**，避免千篇一律的模板感。
   - 桌面端现有表现不退化。

2. **Preview 页 iframe**
   - 仍使用同一份 `buildStandaloneHtml` 输出，移动端样式在 iframe 内同步生效；结合需求四的多分辨率，在不同预览宽度下验证效果。

3. **设计自由度**
   - 无品牌字、禁止字号等约束，以「新颖好看」和移动端体验为准，可由实现方在层级、留白、动效、圆角、色彩等上做合理发挥。

### 验收

- 在 375px、414px 等典型手机宽度下，导出 HTML 无大面积无效留白，标题/描述/文案层级清晰，整体观感新颖、好看。
- 按钮/选项易于点击；Preview 在手机预览宽度（含多分辨率）下与导出 HTML 在真机表现一致或接近。

---

## 需求四：Preview 页多分辨率手机预览（三栏布局 + 分辨率切换位置）

### 目标

Preview 页**继续沿用三栏布局**（左变体列表 | 中手机预览 | 右导出面板）。在「手机预览」区域支持**多种手机分辨率/尺寸切换**，分辨率切换控件放在**手机预览区域的右上方**，不改变整体三栏结构。

### 现状

- **PhoneMockup**：固定 `max-w-[420px]`、iframe 高度 `h-[720px]`，无分辨率选择。
- **Preview 布局**：三栏网格，中栏为手机预览。

### 迭代内容

1. **多分辨率/设备预设**
   - 在「手机预览」区域增加**分辨率或设备预设**选择（如 375×667、390×844、414×896 等，或 iPhone SE / 14 / 14 Pro Max、安卓等标签），至少 3–5 种可选。
   - 选择不同预设时，PhoneMockup 的 iframe 宽高按该预设更新（或缩放后保持比例），预览内容按对应视口重排。
   - 预设列表可配置（宽×高或设备 id），组件根据当前预设设置 iframe 尺寸或缩放。

2. **分辨率切换控件位置**
   - **仅**在「手机预览」区域生效：控件置于**手机预览区域的右上方**（即中栏卡片内、手机框或标题的右上方），不放在整页右上角。
   - 三栏布局保持不变，不新增整页级顶部栏或右侧辅助区。

3. **PhoneMockup 组件**
   - 接受可选参数：如 `width`、`height` 或 `presetId`，用于设置容器与 iframe 尺寸；默认与当前 420×720 或默认预设一致。
   - 若使用缩放以 fit 父容器，需保证清晰度与可读性。

### 验收

- Preview 页仍为三栏布局：左变体列表、中手机预览、右导出面板。
- 用户可在手机预览区域选择至少 3 种分辨率/设备预设，切换后预览尺寸/比例随之变化，内容按新视口正确重排。
- 分辨率切换控件仅位于手机预览区域右上方，不占用整页右上角或其他栏位。
- 常见桌面分辨率下三栏不拥挤、不重叠，主操作路径清晰。

---

## 实施顺序建议

| 顺序 | 需求 | 说明 |
|------|------|------|
| 1 | 需求一（ZIP material + 仅 dmScripts） | 改动集中且明确，优先实现。 |
| 2 | 需求二（3:4 截图与 HTML） | 确定小红书竖图规格与 HTML 一屏展示。 |
| 3 | 需求三（移动端排版） | 与需求二、四共用同一套 HTML，统一收口。 |
| 4 | 需求四（多分辨率 + 控件位置） | 依赖需求三的移动端样式，三栏不变，分辨率切换在手机预览右上方。 |

---

文档已按上述确认定稿，可直接进入开发实现。
